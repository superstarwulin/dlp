define("mui/dlp/index",function(e,t,a){function c(e,t,a){return(e.replace(/#.+/,"")+(t?"&"+S.param(t):"")).replace(/\W+/g,"_").substr(-a)}function l(e){var t=e.key,a=e.storage||sessionStorage;if(t){return{get:function(e){var c;try{return(c=a.getItem(t+"_"+e))&&JSON.parse(c)}catch(l){}return null},set:function(e,c){try{var l=[];for(var s in a){if(s.indexOf(t+"_")===0){l.push(s)}}if(l.length>16){l.sort(function(e,t){return(JSON.parse(a.getItem(t)).timestamp||0)-(JSON.parse(a.getItem(e)).timestamp||0)});for(var r=l.length-1;r>=8;r--){a.removeItem(l[r])}}}catch(n){}try{if(!c){a.removeItem(t+"_"+e)}else{a.setItem(t+"_"+e,JSON.stringify(c))}}catch(n){}}}}}function s(t,a){switch(t.dataType){case"jsonp":t.method=t.dataType;t.callback=t.jsonpCallback;t.jsonpCallback="callback";e(["mui/fetch/jsonp"],function(e){a(e(t.url,t).then(function(e){return e.json()}))});break;case"json":e(["mui/fetch/fetch"],function(e){a(e(t.url,t).then(function(e){return e.json()}))});break;default:e(["mui/fetch/fetch"],function(e){a(e(t.url,t).then(function(e){return e.text()}))});break}}var r={get:function(e){var t=this,a=null,r=window,n=+new Date,o=null,i=e.cacheExpiryTime||7*24*60*60*1e3,u=e.cacheValidTime||0;switch(e.localCacheType){case"sessionStorage":if(r.sessionStorage){a=l({key:"_DLP_v1",storage:r.sessionStorage})}break;case"localStorage":if(r.localStorage){a=l({key:"_DLP_v1",storage:r.localStorage})}break}var f=c(e.url,e.data,1024);var p=a&&a.get(f);if(p&&p.timestamp<=n-i){p=null}function m(t){if(!o||e.multipleCallback&&o.level<5){var a={type:"cache",status:t,level:5,last:o};o=a;window.console&&console.log(["[dlp]callback:",a]);e.success&&e.success(p.data,"success",a);e.complete&&e.complete(p.data,"success",a)}}if(p){if(p.timestamp>n-u){return m("init")}setTimeout(function(){m("loading")},e.cacheDelayTime)}function d(t,c){a&&(!e.localCacheVerify||e.localCacheVerify(t))&&a.set(f,{timestamp:+new Date,data:t});if(!o||e.multipleCallback&&o.level<8){var l={type:"regular",status:"success",level:8,last:o};o=l;window.console&&console.log(["[dlp]callback:",l]);e.success&&e.success(t,c,l);e.complete&&e.complete(t,c,l)}}function k(t,a,c){if(!o||e.multipleCallback&&o.level<2){if(p){m("error")}else{if(e.backup&&e.backup.url){function l(t,a){var c={type:"backup",status:"backupsuccess",level:2,last:o};o=c;window.console&&console.log(["[dlp]callback:",c]);e.success&&e.success(t,a,c);e.complete&&e.complete(t,a,c)}function r(l,s){var r={type:"error",status:"backuperror",level:2,last:o};o=r;S.log(["[dlp]callback:",r]);if(c===false){e.success&&e.success(t,a,r)}else{e.error&&e.error(l,s,r)}e.complete&&e.complete(l,s,r)}s(e.backup,function(t){t.then(function(t,a){if(o&&!(e.multipleCallback&&o.level<2)){return}!e.dataVerify||e.dataVerify(t)?l(t,"success"):r(t,"success")}).catch(function(t){if(o&&!(e.multipleCallback&&o.level<2)){return}r(t,"error")})})}else{if(!o||e.multipleCallback&&o.level<8){var n={type:"error",status:"error",level:8,last:o};o=n;window.console&&console.log(["[dlp]callback:",n]);if(c===false){e.success&&e.success(t,a,n)}else{e.error&&e.error(t,a,n)}e.complete&&e.complete(t,a,n)}}}}}if(e.cache!==false){e.cache=true;if(e.dataType==="jsonp"&&!e.jsonpCallback){e.jsonpCallback="_DLP_"+parseInt(+new Date/i)+"_"+c(e.url,e.data,32)}}s(e,function(t){t.then(function(t){var a=!e.dataVerify||e.dataVerify(t);a?d(t,"success"):k(t,"success",a)}).catch(function(e){k(e,"error")})})},jsonp:function(e){e.dataType="jsonp";return this.get(e)},ald:function(e){e.dataType="jsonp";e.backup=e.backup||{};e.backup.dataType="jsonp";return this.get(e)}};a.exports=r});